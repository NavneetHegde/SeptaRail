name: Trigger Azure Pipeline on PR merge to master

on:
  pull_request:
    branches:
      - master
    types: [closed]  

pool:
  vmImage: windows-latest

steps:
  - task: DotNetCoreCLI@2
    displayName: 'Build and Publish'
    inputs:
      command: publish
      arguments: '--configuration Release --output publish_output'
      projects: 'src/GetTrainsFunction/GetTrainsFunction.csproj'
      publishWebProjects: false
      modifyOutputPath: false
      zipAfterPublish: false
  - task: ArchiveFiles@2
    displayName: "Archive Files"
    inputs:
      rootFolderOrFile: "$(System.DefaultWorkingDirectory)/publish_output"
      includeRootFolder: false
      archiveFile: "$(System.DefaultWorkingDirectory)/build$(Build.BuildId).zip"
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact'
    inputs:
      PathtoPublish: '$(System.DefaultWorkingDirectory)/build$(Build.BuildId).zip'
      ArtifactName: 'drop'
